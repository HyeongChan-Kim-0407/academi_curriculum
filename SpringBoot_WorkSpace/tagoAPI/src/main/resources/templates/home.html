<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>TAGO</title>
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css"
	rel="stylesheet"
	integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr"
	crossorigin="anonymous">
<script
	src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"
	integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q"
	crossorigin="anonymous"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
</head>
<body>

	<div class="container">
		<button class="btn btn-primary w-100 mt-5" onclick="getStationList()">주변 정류소 찾기</button>
		<div class="row my-5">
			<!-- 정류소 목록 -->
			<div class="col-3">
				<div class="list-group" id="stationList">
					<!-- <button type="button" class="list-group-item list-group-item-action" data-bs-toggle="list" >정류소 1</button>
					<button type="button" class="list-group-item list-group-item-action" data-bs-toggle="list" >정류소 2</button>
					<button type="button" class="list-group-item list-group-item-action" data-bs-toggle="list" >정류소 3</button>
					<button type="button" class="list-group-item list-group-item-action" data-bs-toggle="list" >정류소 4</button>
					<button type="button" class="list-group-item list-group-item-action" data-bs-toggle="list" >정류소 5</button> -->
				</div>
			</div>
			<!-- 선택된 정류소를 경유하는 노선 정보 출력 -->
			<div class="col-4">
				<div class="list-group" id="busList">
					<!-- <button type="button" class="list-group-item list-group-item-action" >버스 1</button>
					<button type="button" class="list-group-item list-group-item-action" >버스 2</button>
					<button type="button" class="list-group-item list-group-item-action" >버스 3</button>
					<button type="button" class="list-group-item list-group-item-action" >버스 4</button>
					<button type="button" class="list-group-item list-group-item-action" >버스 5</button> -->
				</div>
			</div>
			
			<div id="">
			
			</div>
			
		</div>
	</div>
	
	<script type="text/javascript">
		let gpsLati = "37.455706";
		let gpsLong = "126.705759";
		
		function getStationList(){
			$.ajax({
				type: "get",
				url: "/getStationList",
				data: {'lat' : gpsLati, 'lng' : gpsLong},
				dataType: "json",
				success: function(response){
					console.log(response.response.body.items.item);
					showStationList(response.response.body.items.item);
				},
			});
		}
		
		const stationListBox = document.getElementById("stationList");
		
		function showStationList(sttnList){
			stationListBox.innerHTML = ""; // 기존 목록 초기화
			for(let st of sttnList){
				console.log(st.nodenm);
				stationListBox.innerHTML += 
					`<button type="button" class="list-group-item list-group-item-action" data-bs-toggle="list" onclick="getBusList('${st.citycode}', '${st.nodeid}')">${st.nodenm}</button>`;
			}
		}
		
		function getBusList(citycode, nodeid){
			console.log("도시코드 : " + citycode);
			console.log("노드아이디 : " + nodeid);
			$.ajax({
				type: "get",
				url: "/getBusList",
				data: {'citycode' : citycode, 'nodeid' : nodeid},
				dataType: "json",
				success: function(response){
					console.log(response);
					showBusList(response.response.body.items.item);
				},
			});
		}
		
		const busListBox = document.getElementById("busList");
		
		function showBusList(busList){
            busListBox.innerHTML = ""; // 기존 목록 초기화
            for(let bus of busList){
            	let arrtime = Math.round(bus.arrtime / 60);
                console.log(bus.routeno);
                busListBox.innerHTML += 
                    `<button type="button" class="list-group-item list-group-item-action">${bus.routeno}번 ${bus.routetp} ${bus.arrprevstationcnt}개전 ${arrtime}분</button>`;
            }
        }
		
	</script>
	
</body>
</html>