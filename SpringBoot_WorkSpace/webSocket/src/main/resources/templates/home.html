<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>webSocket</title>
</head>
<body>

<h1>webSocket</h1>
	<div id="chatBox"></div>
	<input type="text" id="inputText"> <button onclick="sendMessage()">전송</button>
	
	
	

	
<script type="text/javascript" src="/webjars/sockjs-client/1.5.1/sockjs.js"></script>	
<script type="text/javascript" src="/webjars/stomp-websocket/2.3.4/stomp.js"></script>
<script type="text/javascript">

/* WebSocket에 연결 (접속요청) */

	const chatSocket = new SockJS("/ws-chatin");
	const chatClient = Stomp.over(chatSocket);
	
	chatClient.connect({}, function(frame){
		console.log("chatSocket 연결 확인");
		console.log(frame);
		
		/* 서버에서 전송되는 메시지의 종류 구분 (구독) */
		chatClient.subscribe("/ServerToClient/publicMsg", function(msg){
			console.log("/serverToClient/publicMsg 구독"); 
			showMsg(msg.body);
		});
		
	});


/* 클라이언트에서 서버에게 메시지를 전송하는 기능 */
	const inputEl = document.getElementById("inputText");
	function sendMessage(){
		const msgObject = { "type" : "text", "content" : inputEl.value }; // "파라미터이름" : "파라미터값"
		// input 태그에 입력한 값을 WebSocket 서버에 전송
		chatClient.send("/ClientToServer/chatMsg", // 서버에 보내는 주소
				{},
				JSON.stringify(msgObject)); // 보내는 메시지 object >> JSON 형태의 String
	}
	/* 서버에서 받은 메시지를 출력하는 기능 */
	const chatBoxEl = document.getElementById("chatBox"); // 채팅 출력 박스 선택
	function showMsg(msg){ // 메시지 출력
		let msgObj = JSON.parse(msg); // JSON 형태의 String을 Object로 변환
		chatBoxEl.innerHTML += `<p> ${msgObj.sender} : ${msgObj.content}</p>`
	}
	
	
	
	
</script>
</body>
</html>