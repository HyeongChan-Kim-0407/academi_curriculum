<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />

    <title>íšŒì›ê°€ì…</title>

    <!-- Bootstrap CSS & JS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT"
      crossorigin="anonymous"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-j1CDi7MgGQ12Z7Qab0qlWQ/Qqz24Gc6BM0thvEMVjHnfYGF0rmFCozFSxQBxwHKO"
      crossorigin="anonymous"
    ></script>
    <!-- ìŠ¤íƒ€ì¼ ì œê±°, Bootstrap í´ë˜ìŠ¤ë§Œ ì‚¬ìš© -->
    <!-- Bootstrap Icons -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"
    />
  </head>

  <body>
    <!-- ìƒë‹¨ ë°” -->
    <div
      class="d-flex justify-content-between align-items-center px-5 py-3"
      style="background: #e9ecef"
    >
      <div class="d-flex align-items-center">
        <a href="/" style="text-decoration: none">
          <span style="font-size: 2rem; color: #ff6f0f; margin-right: 8px"
            >ğŸŠ</span
          >
          <span class="fw-bold" style="font-size: 2rem; color: #ff6f0f"
            >PROJECT</span
          >
        </a>
      </div>
      <div>
        <a
          href="/member/join"
          class="btn"
          style="
            background: #ff6f0f;
            color: #fff;
            font-weight: bold;
            border-radius: 8px;
            padding: 10px 24px;
            font-size: 1rem;
          "
          >íšŒì›ê°€ì…</a
        >
        <a
          href="/member/login"
          class="btn ms-2"
          style="
            background: #222;
            color: #fff;
            font-weight: bold;
            border-radius: 8px;
            padding: 10px 24px;
            font-size: 1rem;
          "
          >ë¡œê·¸ì¸</a
        >
      </div>
    </div>
    <!-- ë©”ì¸ ì»¨í…ì¸  -->
    <div>
      <h1 class="text-center my-4">
        <span style="font-size: 2rem; color: #ff6f0f">ğŸŠ</span>
        <span class="fw-bold" style="font-size: 2rem; color: #ff6f0f"
          >íšŒì›ê°€ì…</span
        >
      </h1>
    </div>
    <div class="d-flex justify-content-center align-items-center mb-3">
      <form
        action="/member/joinForm"
        method="get"
        th:object="${memberForm}"
        onsubmit="return checkEl(this)"
      >
        <label for="mid" class="form-label">ì•„ì´ë”” </label>
        <div class="input-group mb-3">
          <!-- th:field = "*{í•„ë“œëª…}" >> id, name, value ì†ì„±ì„ ìë™ìœ¼ë¡œ ì¶”ê°€ -->
          <!-- is-invalid : ì˜¤ë¥˜ê°€ ìˆì„ ë•Œ ì¶”ê°€í•  class -->
          <input
            type="text"
            class="form-control"
            th:field="*{mid}"
            th:classappend="${#fields.hasErrors('mid')}? 'is-invalid'"
          />
          <button
            class="btn btn-outline-secondary btn-ff6f0f text-light"
            type="button"
            onclick="checkDuplicateId()"
            id=""
            style="background: #ff6f0f; color: #fff"
          >
            ì¤‘ë³µí™•ì¸
          </button>
          <!-- th:classappend="ì¡°ê±´ì‹? 'ì¶”ê°€í•  í´ë˜ìŠ¤ëª…'" : ì¡°ê±´ë¬¸ì´ trueì´ë©´ 'ì¶”ê°€í•  í´ë˜ìŠ¤ëª…'ì„ í´ë˜ìŠ¤ ëª©ë¡ì— ì¶”ê°€ -->
          <p
            class="invalid-feedback"
            th:if="${#fields.hasErrors('mid')}"
            th:errors="*{mid}"
          ></p>
        </div>
        <div>
          <small class="mb-100" id="checkMsg"></small>
        </div>
        <div class="mb-3">
          <label for="mpw" class="form-label">ë¹„ë°€ë²ˆí˜¸</label>
          <input
            type="text"
            class="form-control"
            th:field="*{mpw}"
            th:classappend="${#fields.hasErrors('mpw')}? 'is-invalid'"
          />
          <p
            class="invalid-feedback"
            th:if="${#fields.hasErrors('mpw')}"
            th:errors="*{mpw}"
          ></p>
        </div>
        <div class="mb-3">
          <label for="mname" class="form-label">ì´ë¦„</label>
          <input
            type="text"
            class="form-control"
            th:field="*{mname}"
            th:classappend="${#fields.hasErrors('mname')}? 'is-invalid'"
          />

          <p
            class="invalid-feedback"
            th:if="${#fields.hasErrors('mname')}"
            th:errors="*{mname}"
          ></p>
          <div class="mb-3">
            <label for="mphone" class="form-label">ì—°ë½ì²˜</label>
            <input type="text" class="form-control" th:field="*{mphone}" />
          </div>
        </div>
        <div class="mb-3">
          <label for="memail" class="form-label">ì´ë©”ì¼</label>
          <input type="email" class="form-control" th:field="*{memail}" />
        </div>
        <div class="mb-3">
          <label for="maddress" class="form-label">ì£¼ì†Œ</label>
          <div class="input-group">
            <input
              type="text"
              class="form-control"
              th:field="*{maddress}"
              id="maddress"
            />
            <button
              type="button"
              class="btn btn-outline-secondary"
              style="background: #ff6f0f; color: #fff; font-weight: bold"
              onclick="execDaumPostcode()"
            >
              ì£¼ì†Œê²€ìƒ‰
            </button>
          </div>
        </div>
        <p>íšŒì› ìœ í˜•</p>
        <div class="form-check">
          <input
            class="form-check-input"
            type="radio"
            name="mtype"
            id="org"
            value="ê¸°ê´€ íšŒì›"
          />
          <label class="form-check-label" for="org"> ê¸°ê´€ íšŒì› </label>
        </div>
        <div class="form-check">
          <input
            class="form-check-input"
            type="radio"
            name="mtype"
            id="ind"
            checked
            value="ê°œì¸ íšŒì›"
          />
          <label class="form-check-label" for="ind"> ê°œì¸ íšŒì› </label>
        </div>
        <!-- ê´€ì‹¬ì‚¬ (íŒŒí‹°ë£¸, ì˜¤í”¼ìŠ¤ ë“±ë“±) -->
        <p>ì„ í˜¸ ì‹œì„¤</p>
        <div class="mt-3 card shadow-sm">
          <div class="card-body">
            <div class="form-check mb-3" style="display: inline-block">
              <input
                class="form-check-input"
                type="checkbox"
                id="minterests_partyroom"
                value="partyroom"
                name="minterests"
              />
              <label class="form-check-label" for="partyroom"> íŒŒí‹°ë£¸ </label>
            </div>
            <div class="form-check mb-3 ms-2" style="display: inline-block">
              <input
                class="form-check-input"
                type="checkbox"
                id="minterests_office"
                value="office"
                name="minterests"
              />
              <label class="form-check-label" for="office"> ì˜¤í”¼ìŠ¤ </label>
            </div>
            <div class="form-check mb-3 ms-2" style="display: inline-block">
              <input
                class="form-check-input"
                type="checkbox"
                id="minterests_practice"
                value="practice"
                name="minterests"
              />
              <label class="form-check-label" for="practice"> ì—°ìŠµì‹¤ </label>
            </div>
            <div class="form-check mb-3" style="display: inline-block">
              <input
                class="form-check-input"
                type="checkbox"
                id="minterests_downtown"
                value="downtown"
                name="minterests"
              />
              <label class="form-check-label" for="downtown"> ìƒê°€ </label>
            </div>
            <div class="form-check mb-3" style="display: inline-block">
              <input
                class="form-check-input"
                type="checkbox"
                id="minterests_studtroom"
                value="studtroom"
                name="minterests"
              />
              <label class="form-check-label" for="studtroom"> ìŠ¤í„°ë””ë£¸ </label>
            </div>
            <div class="form-check mb-3" style="display: inline-block">
              <input
                class="form-check-input"
                type="checkbox"
                id="minterests_hotel"
                value="hotel"
                name="minterests"
              />
              <label class="form-check-label" for="hotel"> ìˆ™ì†Œ </label>
            </div>
          </div>
        </div>
        <button
          type="submit"
          class="btn mt-4 w-100"
          style="background: #ff6f0f; color: #fff"
        >
          íšŒì›ê°€ì…
        </button>
      </form>
    </div>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <!-- ë‹¤ìŒ ì£¼ì†Œ API ìŠ¤í¬ë¦½íŠ¸ -->
    <script src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
    <script type="text/javascript">
      // ë‹¤ìŒ ì£¼ì†Œ ê²€ìƒ‰ API ì—°ë™
      function execDaumPostcode() {
        new daum.Postcode({
          oncomplete: function (data) {
            // ë„ë¡œëª…ì£¼ì†Œ, ì§€ë²ˆì£¼ì†Œ, ê±´ë¬¼ëª… ë“±ì—ì„œ ê°€ì¥ ì í•©í•œ ì£¼ì†Œë¥¼ ì„ íƒ
            var fullAddr = data.roadAddress
              ? data.roadAddress
              : data.jibunAddress;
            if (!fullAddr) fullAddr = data.address;
            document.getElementById("maddress").value = fullAddr;
          },
        }).open();
      }
      let isDuplicated;

      document.getElementById("mid").addEventListener("input", function () {
        isDuplicated = false;
        document.getElementById("checkMsg").innerHTML = "";
        document.getElementById("mid").classList.remove("is-invalid");
        document.getElementById("mid").classList.remove("is-valid");
      });

      function checkEl(form) {
        const inputId = form.mid;

        if (!isDuplicated) {
          alert("ì•„ì´ë””ë¥¼ í™•ì¸í•´ì£¼ì‹­ì‹œì˜¤.");
          return false;
        }
        return true;
      }

      function checkDuplicateId() {
        const checkMsg = document.getElementById("checkMsg");
        const mid = document.getElementById("mid");
        const midError = document.getElementById("midError");
        if (mid.value.trim() <= 0) {
          checkMsg.innerHTML = "ì•„ì´ë””ë¥¼ ì…ë ¥í•´ì£¼ì‹­ì‹œì˜¤.";
          mid.classList.add("is-invalid");
          mid.classList.remove("is-valid");
          checkMsg.classList.remove("text-green");
          checkMsg.classList.add("text-red");
          return;
        }
        console.log(mid.value);
        $.ajax({
          url: "/member/idCheck",
          type: "post",
          data: { mid: mid.value.trim() },
          success: function (response) {
            if (response == "Y") {
              mid.classList.add("is-valid");
              mid.classList.remove("is-invalid");
              checkMsg.innerHTML = "ì‚¬ìš© ê°€ëŠ¥í•œ ì•„ì´ë””ì…ë‹ˆë‹¤.";
              checkMsg.classList.add("text-green");
              checkMsg.classList.remove("text-red");
              isDuplicated = true;
            } else if (response == "N") {
              mid.classList.add("is-invalid");
              mid.classList.remove("is-valid");
              checkMsg.innerHTML = "ì‚¬ìš©í•  ìˆ˜ ì—†ëŠ” ì•„ì´ë””ì…ë‹ˆë‹¤.";
              checkMsg.classList.remove("text-green");
              checkMsg.classList.add("text-red");
              isDuplicated = false;
            }
          },
        });
      }
    </script>
  </body>
</html>
