<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
  <head>
    <style>
      input:focus {
        outline: none !important;
        box-shadow: none !important;
        border-color: #ff6f0f !important;
      }

      .step-indicator.active div:first-child {
        background: #ff6f0f !important;
        border-color: #ff6f0f !important;
      }

      .step-indicator.active .bi {
        color: #222 !important;
      }

      .step-indicator.active div:nth-child(2),
      .step-indicator.active div:nth-child(3) {
        color: #222 !important;
      }
    </style>
    <meta charset="UTF-8" />

    <title>회원가입</title>

    <!-- Bootstrap CSS & JS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT"
      crossorigin="anonymous"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-j1CDi7MgGQ12Z7Qab0qlWQ/Qqz24Gc6BM0thvEMVjHnfYGF0rmFCozFSxQBxwHKO"
      crossorigin="anonymous"
    ></script>
    <!-- 스타일 제거, Bootstrap 클래스만 사용 -->
    <!-- Bootstrap Icons -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"
    />
  </head>

  <body>
    <!-- 메인 컨텐츠 -->
    <div
      class="d-flex justify-content-between align-items-center px-5 pt-4"
      style="background: #fff"
    >
      <div class="d-flex align-items-center">
        <div class="d-flex flex-column align-items-start">
          <a
            href="/"
            class="fw-bold"
            style="
              font-size: 2rem;
              color: #ff6f0f;
              line-height: 1.1;
              text-decoration: none !important;
            "
            >PROJECT</a
          >
          <span
            class="ms-1"
            style="
              font-size: 0.95rem;
              color: #444;
              font-weight: 500;
              line-height: 1.1;
              margin-top: 2px;
              margin-bottom: 0;
            "
            >공간 대여 플랫폼</span
          >
        </div>
      </div>

      <div>
        <!-- 로그인 상태에 따라 버튼 표시 -->

        <a
          href="/member/login"
          class="btn ms-2"
          style="
            background: #222;
            color: #fff;
            font-weight: bold;
            border-radius: 8px;
            padding: 10px 24px;
            font-size: 1rem;
          "
          >로그인</a
        >
      </div>
    </div>
    <form action="/member/joinForm" method="get" th:object="${memberForm}">
      <div
        style="
          text-align: center;
          font-size: 1.45rem;
          font-weight: 700;
          margin-bottom: 50px;
          color: #222;
        "
      >
        회원가입
      </div>

      <!-- 3단계 진행바 -->
      <div
        id="join-steps"
        class="d-flex justify-content-center align-items-center mb-3"
        style="gap: 18px"
      >
        <div
          id="step-indicator-1"
          class="step-indicator active"
          style="display: flex; flex-direction: column; align-items: center"
        >
          <div
            style="
              width: 64px;
              height: 64px;
              background: #ff6f0f;
              border-radius: 50%;
              display: flex;
              align-items: center;
              justify-content: center;
              border: 2px solid #ffe07a;
            "
          >
            <i
              class="bi bi-pencil-square"
              style="font-size: 2rem; color: #222"
            ></i>
          </div>
          <div
            style="
              font-weight: 700;
              font-size: 1.08rem;
              color: #222;
              margin-top: 4px;
            "
          >
            step 1
          </div>
          <div style="font-size: 0.95rem; color: #888">개인정보 입력</div>
        </div>
        <div
          style="
            font-size: 2rem;
            color: #ccc;
            align-self: flex-end;
            margin-bottom: 18px;
          "
        >
          &gt;
        </div>
        <div
          id="step-indicator-2"
          class="step-indicator"
          style="display: flex; flex-direction: column; align-items: center"
        >
          <div
            style="
              width: 64px;
              height: 64px;
              background: #f7f7f7;
              border-radius: 50%;
              display: flex;
              align-items: center;
              justify-content: center;
              border: 2px solid #eee;
            "
          >
            <i class="bi bi-person" style="font-size: 2rem; color: #bbb"></i>
          </div>
          <div
            style="
              font-weight: 700;
              font-size: 1.08rem;
              color: #bbb;
              margin-top: 4px;
            "
          >
            step 2
          </div>
          <div style="font-size: 0.95rem; color: #bbb">개인/기관 선택</div>
        </div>
        <div
          style="
            font-size: 2rem;
            color: #ccc;
            align-self: flex-end;
            margin-bottom: 18px;
          "
        >
          &gt;
        </div>
        <div
          id="step-indicator-3"
          class="step-indicator"
          style="display: flex; flex-direction: column; align-items: center"
        >
          <div
            style="
              width: 64px;
              height: 64px;
              background: #f7f7f7;
              border-radius: 50%;
              display: flex;
              align-items: center;
              justify-content: center;
              border: 2px solid #eee;
            "
          >
            <i
              class="bi bi-card-checklist"
              style="font-size: 2rem; color: #bbb"
            ></i>
          </div>
          <div
            style="
              font-weight: 700;
              font-size: 1.08rem;
              color: #bbb;
              margin-top: 4px;
            "
          >
            step 3
          </div>
          <div style="font-size: 0.95rem; color: #bbb">선호</div>
        </div>
      </div>

      <div
        id="step1"
        class="container mt-5"
        style="
          max-width: 440px;
          margin: auto;
          border-radius: 16px;
          display: block;
        "
      >
        <label for="mid" class="form-label"></label>
        <input
          type="text"
          class="form-control"
          style="border-radius: 16px"
          th:field="*{mid}"
          id="mid"
          placeholder="아이디"
        />
        <label for="mpw" class="form-label"></label>
        <input
          type="password"
          class="form-control"
          style="border-radius: 16px"
          th:field="*{mpw}"
          id="mpw"
          placeholder="비밀번호"
        />
        <label for="mname" class="form-label"></label>
        <input
          type="text"
          class="form-control"
          style="border-radius: 16px"
          th:field="*{mname}"
          id="mname"
          placeholder="이름"
        />
        <label for="mphone" class="form-label"></label>
        <input
          type="text"
          class="form-control"
          style="border-radius: 16px"
          th:field="*{mphone}"
          id="mphone"
          placeholder="연락처"
        />
        <label for="memail" class="form-label"></label>
        <input
          type="email"
          class="form-control"
          style="border-radius: 16px"
          th:field="*{memail}"
          id="memail"
          placeholder="이메일"
        />
        <label for="maddress" class="form-label"></label>
        <div class="input-group">
          <input
            type="text"
            class="form-control"
            style="border-radius: 16px"
            th:field="*{maddress}"
            id="maddress"
            placeholder="주소"
          />
          <button
            type="button"
            class="btn btn-outline-secondary"
            style="
              background: #ff6f0f;
              color: #fff;
              font-weight: bold;
              border-radius: 16px;
            "
            onclick="execDaumPostcode()"
          >
            주소검색
          </button>
        </div>
        <button
          type="button"
          id="nextBtn1"
          class="btn w-100 mt-4"
          style="
            background: #111;
            color: #fff;
            font-size: 1.08rem;
            font-weight: bold;
            border-radius: 20px;
          "
        >
          다음
        </button>
      </div>
      <div
        id="step2"
        class="container mt-5"
        style="
          max-width: 440px;
          margin: auto;
          border-radius: 16px;
          display: none;
        "
      >
        <p>회원 유형</p>
        <div class="form-check">
          <input
            class="form-check-input"
            type="radio"
            name="mtype"
            id="org"
            value="기관 회원"
          />
          <label class="form-check-label" for="org"> 기관 회원 </label>
        </div>
        <div class="form-check">
          <input
            class="form-check-input"
            type="radio"
            name="mtype"
            id="ind"
            checked
            value="개인 회원"
          />
          <label class="form-check-label" for="ind"> 개인 회원 </label>
        </div>
        <button
          type="button"
          id="nextBtn2"
          class="btn w-100 mt-4"
          style="
            background: #111;
            color: #fff;
            font-size: 1.08rem;
            font-weight: bold;
            border-radius: 20px;
          "
        >
          다음
        </button>
      </div>

      <div
        id="step3"
        class="container mt-5"
        style="
          max-width: 440px;
          margin: auto;
          border-radius: 16px;
          display: none;
        "
      >
        <p>선호 시설</p>
        <div class="mt-3 card shadow-sm">
          <div class="card-body">
            <div class="form-check mb-3" style="display: inline-block">
              <input
                class="form-check-input"
                type="checkbox"
                id="minterests_partyroom"
                value="partyroom"
                name="minterests"
              />
              <label class="form-check-label" for="partyroom"> 파티룸 </label>
            </div>
            <div class="form-check mb-3 ms-2" style="display: inline-block">
              <input
                class="form-check-input"
                type="checkbox"
                id="minterests_office"
                value="office"
                name="minterests"
              />
              <label class="form-check-label" for="office"> 오피스 </label>
            </div>
            <div class="form-check mb-3 ms-2" style="display: inline-block">
              <input
                class="form-check-input"
                type="checkbox"
                id="minterests_practice"
                value="practice"
                name="minterests"
              />
              <label class="form-check-label" for="practice"> 연습실 </label>
            </div>
            <div class="form-check mb-3" style="display: inline-block">
              <input
                class="form-check-input"
                type="checkbox"
                id="minterests_downtown"
                value="downtown"
                name="minterests"
              />
              <label class="form-check-label" for="downtown"> 상가 </label>
            </div>
            <div class="form-check mb-3" style="display: inline-block">
              <input
                class="form-check-input"
                type="checkbox"
                id="minterests_studyroom"
                value="studyroom"
                name="minterests"
              />
              <label class="form-check-label" for="minterests_studyroom"
                >스터디룸</label
              >
            </div>
            <div class="form-check mb-3" style="display: inline-block">
              <input
                class="form-check-input"
                type="checkbox"
                id="minterests_hotel"
                value="hotel"
                name="minterests"
              />
              <label class="form-check-label" for="hotel"> 숙소 </label>
            </div>
          </div>
        </div>
        <button
          type="submit"
          class="btn w-100 mt-4"
          style="
            background: #111;
            color: #fff;
            font-size: 1.08rem;
            font-weight: bold;
            border-radius: 20px;
          "
        >
          회원가입
        </button>
      </div>
    </form>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <!-- 다음 주소 API 스크립트 -->
    <script src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
    <script type="text/javascript">
      // 다음 주소 검색 API 연동
      function execDaumPostcode() {
        new daum.Postcode({
          oncomplete: function (data) {
            // 도로명주소, 지번주소, 건물명 등에서 가장 적합한 주소를 선택
            var fullAddr = data.roadAddress
              ? data.roadAddress
              : data.jibunAddress;
            if (!fullAddr) fullAddr = data.address;
            document.getElementById("maddress").value = fullAddr;
          },
        }).open();
      }
      let isDuplicated;

      document.getElementById("mid").addEventListener("input", function () {
        isDuplicated = false;
        document.getElementById("checkMsg").innerHTML = "";
        document.getElementById("mid").classList.remove("is-invalid");
        document.getElementById("mid").classList.remove("is-valid");
      });

      function checkEl(form) {
        const inputId = form.mid;

        if (!isDuplicated) {
          alert("아이디를 확인해주십시오.");
          return false;
        }
        return true;
      }

      function checkDuplicateId() {
        const checkMsg = document.getElementById("checkMsg");
        const mid = document.getElementById("mid");
        const midError = document.getElementById("midError");
        if (mid.value.trim() <= 0) {
          checkMsg.innerHTML = "아이디를 입력해주십시오.";
          mid.classList.add("is-invalid");
          mid.classList.remove("is-valid");
          checkMsg.classList.remove("text-green");
          checkMsg.classList.add("text-red");
          return;
        }
        console.log(mid.value);
        $.ajax({
          url: "/member/idCheck",
          type: "post",
          data: { mid: mid.value.trim() },
          success: function (response) {
            if (response == "Y") {
              mid.classList.add("is-valid");
              mid.classList.remove("is-invalid");
              checkMsg.innerHTML = "사용 가능한 아이디입니다.";
              checkMsg.classList.add("text-green");
              checkMsg.classList.remove("text-red");
              isDuplicated = true;
            } else if (response == "N") {
              mid.classList.add("is-invalid");
              mid.classList.remove("is-valid");
              checkMsg.innerHTML = "사용할 수 없는 아이디입니다.";
              checkMsg.classList.remove("text-green");
              checkMsg.classList.add("text-red");
              isDuplicated = false;
            }
          },
        });
      }
    </script>
    <script>
      function execDaumPostcode() {
        new daum.Postcode({
          oncomplete: function (data) {
            var fullAddr = data.roadAddress
              ? data.roadAddress
              : data.jibunAddress;
            if (!fullAddr) fullAddr = data.address;
            document.getElementById("maddress").value = fullAddr;
          },
        }).open();
      }

      document.getElementById("nextBtn1").onclick = function () {
        document.getElementById("step1").style.display = "none";
        document.getElementById("step2").style.display = "block";
        document.getElementById("step3").style.display = "none";
        document.getElementById("step-indicator-1").classList.remove("active");
        document.getElementById("step-indicator-2").classList.add("active");
        document.getElementById("step-indicator-3").classList.remove("active");
        // 혹시 step2 진입 시 step3가 보이는 경우를 방지
        setTimeout(function () {
          document.getElementById("step2").style.display = "block";
          document.getElementById("step3").style.display = "none";
        }, 10);
      };
      document.getElementById("nextBtn2").onclick = function () {
        document.getElementById("step2").style.display = "none";
        document.getElementById("step3").style.display = "block";
        document.getElementById("step-indicator-2").classList.add("active");
        document.getElementById("step-indicator-3").classList.add("active");
      };
      document.querySelector("form").onsubmit = function (e) {
        if (document.getElementById("step3").style.display !== "block") {
          e.preventDefault();
          return false;
        }
        return true;
      };
    </script>
  </body>
</html>
