<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />

    <title>PROJECT</title>

    <!-- Bootstrap CSS & JS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT"
      crossorigin="anonymous"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-j1CDi7MgGQ12Z7Qab0qlWQ/Qqz24Gc6BM0thvEMVjHnfYGF0rmFCozFSxQBxwHKO"
      crossorigin="anonymous"
    ></script>

    <!-- Bootstrap Icons -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"
    />
    <style>
      /* ë“œë¡­ë‹¤ìš´ ë²„íŠ¼ í¬ì»¤ìŠ¤ ì‹œ íŒŒë€ìƒ‰ íš¨ê³¼ ì œê±°, ì—°í•œ íšŒìƒ‰ ìœ ì§€ */
      .btn-white:focus,
      .btn-white:active,
      .btn-white:focus-visible {
        background: #f2f2f2 !important;
        color: #222 !important;
        box-shadow: none !important;
        outline: none !important;
        border-color: #dee2e6 !important;
      }
      /* ê²€ìƒ‰ì°½ í¬ì»¤ìŠ¤ ì‹œ íŒŒë€ìƒ‰/ê·¸ë¦¼ì ì œê±°, ì£¼í™©ìƒ‰ í…Œë‘ë¦¬ë§Œ */
      .form-control:focus {
        border-color: #ff6f0f !important;
        box-shadow: none !important;
        outline: none !important;
      }
      .card-hover {
        transition: transform 0.18s, box-shadow 0.18s;
        cursor: pointer;
      }
      .card-hover:hover {
        transform: scale(1.07);
        box-shadow: 0 8px 24px #ff6f0f33;
      }
      .custom-option:hover,
      .custom-option:focus {
        background: #f2f2f2 !important;
        color: #222 !important;
      }
      .fab-plus {
        position: fixed;
        right: 32px;
        bottom: 32px;
        width: 64px;
        height: 64px;
        border-radius: 50%;
        background: #ff6f0f;
        color: #fff;
        box-shadow: 0 4px 16px #0002;
        border: none;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2.2rem;
        z-index: 999;
        cursor: pointer;
      }
    </style>
  </head>

  <body>
    <div
      class="d-flex justify-content-between align-items-center px-5 pt-4 bg-white"
    >
      <div class="d-flex align-items-center">
        <div class="d-flex flex-column align-items-start">
          <a
            class="fw-bold fs-2 lh-1 text-decoration-none"
            style="color: #ff6f0f"
            >PROJECT</a
          >
          <span class="ms-1 small fw-medium lh-1 mt-1 mb-0" style="color: #444"
            >ê³µê°„ ëŒ€ì—¬ í”Œë«í¼</span
          >
        </div>
      </div>
      <div>
        <!-- ë¡œê·¸ì¸ ìƒíƒœì— ë”°ë¼ ë²„íŠ¼ í‘œì‹œ -->
        <th:block th:if="${session.loginMid == null}">
          <a
            href="/member/join"
            class="btn fw-bold rounded-2 px-4 py-2"
            style="background: #ff6f0f; color: #fff"
            >íšŒì›ê°€ì…</a
          >
          <a
            href="/member/login"
            class="btn btn-dark fw-bold rounded-2 px-4 py-2 ms-2"
            >ë¡œê·¸ì¸</a
          >
        </th:block>

        <th:block th:if="${session.loginMid != null}">
          <div class="dropdown d-inline">
            <a
              class="dropdown-toggle"
              href="#"
              id="userDropdown"
              data-bs-toggle="dropdown"
              aria-expanded="false"
              style="
                color: #222;
                text-decoration: underline;
                font-weight: 600;
                font-size: 1.05rem;
              "
              th:text="${session.mname}"
            ></a>
            <ul class="dropdown-menu" aria-labelledby="userDropdown">
              <li><a class="dropdown-item" href="/member/edit">ìˆ˜ì •</a></li>
              <li>
                <a class="dropdown-item" href="/member/logout">ë¡œê·¸ì•„ì›ƒ</a>
              </li>
              <li>
                <a class="dropdown-item" href="">íšŒì›íƒˆí‡´</a>
              </li>
              <li>
                <a class="dropdown-item" href="/member/myPage">ë§ˆì´í˜ì´ì§€</a>
              </li>
            </ul>
          </div>
          <span
            class="fw-medium"
            style="font-size: 1.05rem; color: #222; margin-right: 16px"
            >ë‹˜ í™˜ì˜í•©ë‹ˆë‹¤!</span
          >
        </th:block>
      </div>
    </div>
    <div
      class="d-flex flex-column align-items-center justify-content-end"
      style="min-height: 30vh; margin-bottom: 0"
    >
      <div
        class="d-flex justify-content-center align-items-center fw-bold fs-2 gap-2 mb-3"
      >
        <i
          class="bi bi-geo-alt-fill"
          style="color: #ff6f0f; font-size: 2.2rem"
        ></i>
        <div class="d-flex flex-column align-items-center">
          <div>
            <span
              id="location-name"
              th:text="${dongName != null && !#strings.isEmpty(dongName) ? dongName : ''}"
            ></span
            >ì—ì„œ <span id="job-rotate"></span> ì°¾ê³  ê³„ì‹ ê°€ìš”?
          </div>
        </div>
      </div>
      <div class="d-flex justify-content-center align-items-center w-100 gap-3">
        <a
          href="/map"
          class="btn btn-dark rounded-pill d-flex align-items-center justify-content-center px-3 py-2"
          style="width: 120px; height: 48px; white-space: nowrap; gap: 6px"
        >
          <i
            class="bi bi-geo-alt-fill"
            style="font-size: 1.2rem; color: #ff6f0f; margin-right: 4px"
          ></i>
          <span style="font-size: 1.05rem">ìœ„ì¹˜ì„¤ì •</span>
        </a>
        <div class="dropdown" style="width: 120px">
          <button
            class="btn btn-white rounded-pill w-100 d-flex align-items-center justify-content-between border border-2"
            type="button"
            id="customSelectBtn"
            data-bs-toggle="dropdown"
            aria-expanded="false"
            style="height: 48px; font-size: 1rem"
          >
            <span id="customSelectValue">ìœ í˜•</span>
            <i class="bi bi-chevron-down ms-2"></i>
          </button>
          <ul
            class="dropdown-menu w-100"
            aria-labelledby="customSelectBtn"
            id="searchType"
            style="border-radius: 18px"
          >
            <li>
              <a
                class="dropdown-item custom-option"
                onclick="selectOption('practice')"
                >ì—°ìŠµì‹¤</a
              >
            </li>
            <li>
              <a
                class="dropdown-item custom-option"
                onclick="selectOption('office')"
                >ì˜¤í”¼ìŠ¤</a
              >
            </li>
            <li>
              <a
                class="dropdown-item custom-option"
                onclick="selectOption('partyroom')"
                >íŒŒí‹°ë£¸</a
              >
            </li>
            <li>
              <a
                class="dropdown-item custom-option"
                onclick="selectOption('downtown')"
                >ìƒê°€</a
              >
            </li>
            <li>
              <a
                class="dropdown-item custom-option"
                onclick="selectOption('studyroom')"
                >ìŠ¤í„°ë””ë£¸</a
              >
            </li>
            <li>
              <a
                class="dropdown-item custom-option"
                onclick="selectOption('hotel')"
                >ìˆ™ì†Œ</a
              >
            </li>
          </ul>
        </div>
        <input
          type="text"
          class="form-control rounded-pill px-4"
          id="searchInput"
          placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”"
          style="height: 48px; width: 320px; font-size: 1rem"
        />
        <button
          class="btn btn-dark rounded-pill d-flex align-items-center justify-content-center px-4 py-2"
          style="height: 48px; font-size: 1.2rem"
          onclick="search()"
        >
          â†’
        </button>
      </div>
    </div>
    <div class="text-center text-secondary mb-5" style="font-size: 0.95rem">
      ì¸ê¸° ê²€ìƒ‰ì–´: ì—°ìŠµì‹¤, ì˜¤í”¼ìŠ¤, íŒŒí‹°ë£¸, ìŠ¤í„°ë””ë£¸, ìˆ™ì†Œ, ìƒê°€
    </div>

    <div class="d-flex justify-content-center gap-4 flex-wrap">
      <!-- ëª¨ë‘ë³´ê¸° ë°•ìŠ¤: í•­ìƒ ì™¼ìª½ì— ê³ ì • -->
      <a href="place/list" style="text-decoration: none">
        <div
          class="rounded-4 shadow-sm p-4 text-center card-hover"
          style="width: 120px; background: #ff6f0f"
        >
          <div style="font-size: 2.5rem; color: #fff">
            <i class="bi bi-grid-fill"></i>
          </div>
          <div class="fw-bold mt-2" style="font-size: 1.1rem; color: #fff">
            <span>ëª¨ë‘ë³´ê¸°</span>
          </div>
        </div>
      </a>

      <!-- ë¡œê·¸ì¸ ì‹œ ê´€ì‹¬ì‚¬ ë°•ìŠ¤ -->
      <div
        th:if="${session.loginMid != null}"
        th:each="interests : ${interests}"
        class="bg-light rounded-4 shadow-sm p-4 text-center card-hover"
        style="width: 120px"
      >
        <span th:switch="${interests.interest}">
          <a
            href="place/list?ptype=partyroom"
            style="text-decoration: none"
            th:case="'partyroom'"
          >
            <div style="font-size: 2.5rem; color: #ff6f0f">
              <span>ğŸˆ</span>
            </div>
            <div class="fw-bold mt-2" style="font-size: 1.1rem; color: #222">
              <span>íŒŒí‹°ë£¸</span>
            </div>
          </a>
          <a
            href="place/list?ptype=office"
            style="text-decoration: none"
            th:case="'office'"
          >
            <div style="font-size: 2.5rem; color: #ff6f0f">
              <span>ğŸ¢</span>
            </div>
            <div class="fw-bold mt-2" style="font-size: 1.1rem; color: #222">
              <span>ì˜¤í”¼ìŠ¤</span>
            </div>
          </a>
          <a
            href="place/list?ptype=practice"
            style="text-decoration: none"
            th:case="'practice'"
          >
            <div style="font-size: 2.5rem; color: #ff6f0f">
              <span>ğŸ¤</span>
            </div>
            <div class="fw-bold mt-2" style="font-size: 1.1rem; color: #222">
              <span>ì—°ìŠµì‹¤</span>
            </div>
          </a>
          <a
            href="place/list?ptype=downtown"
            style="text-decoration: none"
            th:case="'downtown'"
          >
            <div style="font-size: 2.5rem; color: #ff6f0f">
              <span>ğŸ¬</span>
            </div>
            <div class="fw-bold mt-2" style="font-size: 1.1rem; color: #222">
              <span>ìƒê°€</span>
            </div>
          </a>
          <a
            href="place/list?ptype=studyroom"
            style="text-decoration: none"
            th:case="'studyroom'"
          >
            <div style="font-size: 2.5rem; color: #ff6f0f">
              <span>ğŸ«</span>
            </div>
            <div class="fw-bold mt-2" style="font-size: 1.1rem; color: #222">
              <span>ìŠ¤í„°ë””ë£¸</span>
            </div>
          </a>
          <a
            href="place/list?ptype=hotel"
            style="text-decoration: none"
            th:case="'hotel'"
          >
            <div style="font-size: 2.5rem; color: #ff6f0f">
              <span>ğŸ¨</span>
            </div>
            <div class="fw-bold mt-2" style="font-size: 1.1rem; color: #222">
              <span>ìˆ™ì†Œ</span>
            </div>
          </a>
        </span>
      </div>
    </div>

    <!-- í•˜ë‹¨ ì˜¤ë¥¸ìª½ í”Œë¡œíŒ… í”ŒëŸ¬ìŠ¤ ë²„íŠ¼ -->
    <button type="button" id="fab-plus" class="fab-plus" onclick="registPage()">
      <i class="bi bi-plus"></i>
    </button>
  </body>
  <div id="mid" th:data-mid="${mid}" style="display: none"></div>

  <script>
    // ì»¤ìŠ¤í…€ ì…€ë ‰íŠ¸ ë“œë¡­ë‹¤ìš´ ê°’ ë³€ê²½ JS
    document.addEventListener("DOMContentLoaded", function () {
      document.querySelectorAll(".custom-option").forEach(function (option) {
        option.addEventListener("click", function (e) {
          e.preventDefault();
          document.getElementById("customSelectValue").textContent =
            this.textContent;
        });
      });
    });
    let mid = document.getElementById("mid").dataset.mid;
    console.log(mid);
    function registPage() {
      if (mid == null) {
        alert("ë¡œê·¸ì¸ í›„ ì´ìš©í•´ì£¼ì„¸ìš”");
        location.href = "/member/login";
      } else {
        location.href = "/place/regist";
      }
    }
  </script>
  <script>
    const jobList = ["ì—°ìŠµì‹¤", "íŒŒí‹°ë£¸", "ìŠ¤í„°ë””ë£¸", "ì˜¤í”¼ìŠ¤", "ìƒê°€", "ìˆ™ì†Œ"];
    let idx = 0;
    setInterval(() => {
      idx = (idx + 1) % jobList.length;
      document.getElementById("job-rotate").textContent = jobList[idx];
    }, 2000);

    // ìœ„ì¹˜ì„¤ì • ë§í¬ í´ë¦­ ì‹œ ìƒˆ ì°½ìœ¼ë¡œ map.html ì˜¤í”ˆ
    document.addEventListener("DOMContentLoaded", function () {
      // ìœ„ì¹˜ì„¤ì • ë²„íŠ¼ ìƒˆ ì°½ ì˜¤í”ˆ
      const locationBtn = document.querySelector('a[href="/map"]');
      if (locationBtn) {
        locationBtn.addEventListener("click", function (e) {
          e.preventDefault();
          window.open("/map", "_blank", "width=600,height=600");
        });
      }
    });

    // map.htmlì—ì„œ ë™ ì´ë¦„ ë©”ì‹œì§€ ìˆ˜ì‹  ì‹œ location-nameì— ì¶œë ¥
    window.addEventListener("message", function (event) {
      if (event.data && event.data.dong) {
        document.getElementById("location-name").textContent = event.data.dong;
      }
    });

    let selectedOption = "";

    function selectOption(selectValue) {
      selectedOption = selectValue;
      document.getElementById("customSelectValue").textContent =
        optionText(selectValue);
    }

    function optionText(val) {
      switch (val) {
        case "practice":
          return "ì—°ìŠµì‹¤";
        case "office":
          return "ì˜¤í”¼ìŠ¤";
        case "partyroom":
          return "íŒŒí‹°ë£¸";
        case "downtown":
          return "ìƒê°€";
        case "studyroom":
          return "ìŠ¤í„°ë””ë£¸";
        case "hotel":
          return "ìˆ™ì†Œ";
        default:
          return "ìœ í˜•";
      }
    }

    function search() {
      const searchEl = document.getElementById("searchInput").value;
      const locationValue =
        document.getElementById("location-name").textContent;
      let ptype = selectedOption;
      if (!ptype) {
        // ë“œë¡­ë‹¤ìš´ì—ì„œ í˜„ì¬ í‘œì‹œëœ ê°’ì„ ì—­ë§¤í•‘
        const shown = document
          .getElementById("customSelectValue")
          .textContent.trim();
        switch (shown) {
          case "ì—°ìŠµì‹¤":
            ptype = "practice";
            break;
          case "ì˜¤í”¼ìŠ¤":
            ptype = "office";
            break;
          case "íŒŒí‹°ë£¸":
            ptype = "partyroom";
            break;
          case "ìƒê°€":
            ptype = "downtown";
            break;
          case "ìŠ¤í„°ë””ë£¸":
            ptype = "studyroom";
            break;
          case "ìˆ™ì†Œ":
            ptype = "hotel";
            break;
          default:
            ptype = "";
        }
      }
      if (searchEl.length <= 1) {
        alert("2ê¸€ì ì´ìƒ ì…ë ¥í•´ì£¼ì„¸ìš”");
        return;
      }
      location.href = `/place/search?ptitle=${encodeURIComponent(
        searchEl.trim()
      )}&ptype=${encodeURIComponent(ptype)}&plocation=${encodeURIComponent(
        locationValue
      )}`;
    }
  </script>
</html>
