<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8" />

	<title>ÏÉÅÏÑ∏Î≥¥Í∏∞</title>

	<!-- Bootstrap CSS & JS -->
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet"
		integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT" crossorigin="anonymous" />
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js"
		integrity="sha384-j1CDi7MgGQ12Z7Qab0qlWQ/Qqz24Gc6BM0thvEMVjHnfYGF0rmFCozFSxQBxwHKO"
		crossorigin="anonymous"></script>
	<!-- Ïä§ÌÉÄÏùº Ï†úÍ±∞, Bootstrap ÌÅ¥ÎûòÏä§Îßå ÏÇ¨Ïö© -->
	<!-- Bootstrap Icons -->
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" />
	<link href="/css/styles.css" rel="stylesheet" />
	<link rel="icon" type="image/x-icon" href="/assets/favicon.ico" />

	<script th:inline="javascript">
		const msg = /*[[${msg != null ? msg : 'null'}]]*/ null;
		if (msg != null && msg != "null") {
			alert(msg);
		}
	</script>
</head>

<body>
	<!-- Navigation-->
	<!-- <nav class="navbar navbar-expand-lg navbar-dark bg-dark"> -->
	<!-- ÏÉÅÎã® Î∞î -->

	<div class="d-flex justify-content-between align-items-center px-5 py-3" style="background: #e9ecef">
		<div class="d-flex align-items-center">
			<a href="/" style="text-decoration: none">
				<span style="font-size: 2rem; color: #ff6f0f; margin-right: 8px">üçä</span>
				<span class="fw-bold" style="font-size: 2rem; color: #ff6f0f">PROJECT</span>
			</a>
		</div>
		<div>
			<th:block th:if="${session.loginMid != null}">
				<span style="
              font-size: 1.05rem;
              font-weight: 500;
              color: #222;
              margin-right: 16px;
            ">
					<span th:text="${session.mname}"></span>Îãò ÌôòÏòÅÌï©ÎãàÎã§!
				</span>
				<a href="/member/logout" class="btn" style="
              background: #ff6f0f;
              color: #fff;
              font-weight: bold;
              border-radius: 8px;
              padding: 10px 24px;
              font-size: 1rem;
            ">Î°úÍ∑∏ÏïÑÏõÉ</a>
			</th:block>
		</div>
	</div>
	<!-- Product section-->
	<section class="py-5">
		<form th:action="@{/request/requestOrder/{id}(id=${placeDto.id})}" method="post" onsubmit="return validateCheckboxes()">
			<div class="container px-4 px-lg-5 my-5">
				<div class="row gx-4 gx-lg-5 align-items-center">
					<div class="col-md-6">
						<!-- <img
                id="placeImage"
                class="card-img-top mb-5 mb-md-0"
                th:src="${palceDto.pfilenameList.get(0)}"
                alt="ÏÉÅÌíàÏù¥ÎØ∏ÏßÄ"
                style="width: 600px; height: 700px"
              /> -->
						<div class="mt-3 d-flex justify-content-between">
							<button class="btn btn-outline-dark" type="button" onclick="showPrevImage()">
								Ïù¥Ï†Ñ
							</button>
							<button class="btn btn-outline-dark" type="button" onclick="showNextImage()">
								Îã§Ïùå
							</button>
						</div>
					</div>
					<div class="col-md-6">
						<div class="small mb-1" th:text="${placeDto.mid}"></div>
						<h1 class="display-5 fw-bolder" th:text="${placeDto.ptitle}"></h1>
						<div class="fs-5 mb-5">
							<span class="" th:text="'‚Ç©' + ${placeDto.pprice}"></span>
						</div>
						<p class="lead" th:text="${placeDto.pinfo}"></p>
						<div th:if="${session.loginMid != null}">
							<div th:if="${!placeDto.isMine}">
								<div>
									<label for="bdate">ÏòàÏïΩÎÇ†Ïßú</label>
									<input type="date" class="form-control" id="bdate" name="bdate"
										required onchange="getBdateList()" />
								</div>

								<div class="d-flex text-center" th:if="${session.loginMid != placeDto.mid}">
									<div class="form-check mb-3 form-control" style="display: inline-block">
										<input class="form-check-input" type="checkbox" id="r11_13" value="O"
											name="r11_13" />
										<label class="form-check-label" for="r11_13">
											11Ïãú~13Ïãú
										</label>
									</div>
									<div class="form-check mb-3 form-control" style="display: inline-block">
										<input class="form-check-input" type="checkbox" id="r13_15" value="O"
											name="r13_15" />
										<label class="form-check-label" for="r13_15">
											13Ïãú~15Ïãú
										</label>
									</div>
									<div class="form-check mb-3 form-control" style="display: inline-block">
										<input class="form-check-input" type="checkbox" id="r15_17" value="O"
											name="r15_17" />
										<label class="form-check-label" for="r15_17">
											15Ïãú~17Ïãú
										</label>
									</div>
									<div class="form-check mb-3 form-control" style="display: inline-block">
										<input class="form-check-input" type="checkbox" id="r17_19" value="O"
											name="r17_19" />
										<label class="form-check-label" for="r17_19">
											17Ïãú~19Ïãú
										</label>
									</div>
									<div class="form-check mb-3 form-control" style="display: inline-block">
										<input class="form-check-input" type="checkbox" id="r19_21" value="O"
											name="r19_21" />
										<label class="form-check-label" for="r19_21">
											19Ïãú~21Ïãú
										</label>
									</div>
									<div class="form-check mb-3 form-control" style="display: inline-block">
										<input class="form-check-input" type="checkbox" id="r21_23" value="O"
											name="r21_23" />
										<label class="form-check-label" for="r21_23">
											21Ïãú-23Ïãú
										</label>
									</div>
								</div>
								<button class="btn btn-outline-dark flex-shrink-0" type="submit">
									<i class="bi-calendar-check-fill me-1"></i>
									Í±∞Îûò Ïã†Ï≤≠
								</button>

								<!-- <div class="d-flex" th:if="${placeDto.isRequest}">
                      <input
                        class="form-control text-center me-3"
                        id="inputQuantity"
                        type="num"
                        value="1"
                        style="max-width: 3rem; display: none"
                      />
                      <p
                        class="btn btn-outline-dark flex-shrink-0"
                        type="button"
                      >
                        <i class="bi-cart-fill me-1"></i>
                        Ïã†Ï≤≠ ÏôÑÎ£å
                      </p>
                    </div> -->
							</div>
							<div th:if="${placeDto.isMine}">
								<div class="card bg-white" th:if="${session.loginMid == placeDto.mid}">
									<div class="card-body">
										<div>
											<p class="card-text fw-bold mb-0">
												ÌòÑÏû¨ Ïã†Ï≤≠Ïûê
												<span th:text="${rdList.size()}"></span>
												Î™Ö
											</p>
											<hr />

											<!-- <div th:each="request : ${odRequestList}">
                          <div
                            class="d-flex justify-content-between align-items-center justify-items-center mb-3"
                          >
                            <p
                              class="card-text fw-bold mb-0"
                              th:text="${request.mid}"
                            ></p>

                            <div
                              class="btn-group"
                              th:if="${request.requestState == 'Ïã†Ï≤≠ÏôÑÎ£å'}"
                            >
                              <a
                                th:href="@{/product/acceptOrder(pId=${request.productId}, mId=${request.memberId})}"
                                class="btn btn-sm btn-outline-success"
                              >
                                ÏäπÏù∏
                              </a>
                              <a
                                th:href="@{/product/rejectOrder(pId=${request.productId}, mId=${request.memberId})}"
                                class="btn btn-sm btn-outline-danger"
                              >
                                Í±∞Ï†à
                              </a>
                            </div>
                            <div
                              class="btn-group"
                              th:if="${request.requestState != 'Ïã†Ï≤≠ÏôÑÎ£å'}"
                            >
                              <p
                                th:text="${request.requestState} + 'Îê®'"
                                th:classappend="${request.requestState == 'ÏäπÏù∏'} ? 'btn-outline-success' : 'btn-outline-danger'"
                                class="btn btn-sm"
                              >
                                Í±∞ÎûòÏÉÅÌÉú
                              </p>
                            </div>
                          </div>
                        </div> -->
											<div class="d-flex justify-content-between align-items-center justify-items-center"
												th:each="rd : ${rdList}">
												<div th:if="${rd.rstatus == 'ÏöîÏ≤≠ÏôÑÎ£å'}">
													<p class="card-text fw-bold mb-0" th:text="${rd.mid}"></p>
													<p class="card-text fw-bold mb-0" th:text="${rd.bdate}"></p>
													<p th:if="${rd.r11_13 != 'X'}" class="card-text fw-bold mb-0"
														th:text="${rd.r11_13}"></p>
													<p th:if="${rd.r13_15 != 'X'}" class="card-text fw-bold mb-0"
														th:text="${rd.r13_15}"></p>
													<p th:if="${rd.r15_17 != 'X'}" class="card-text fw-bold mb-0"
														th:text="${rd.r15_17}"></p>
													<p th:if="${rd.r17_19 != 'X'}" class="card-text fw-bold mb-0"
														th:text="${rd.r17_19}"></p>
													<p th:if="${rd.r19_21 != 'X'}" class="card-text fw-bold mb-0"
														th:text="${rd.r19_21}"></p>
													<p th:if="${rd.r21_23 != 'X'}" class="card-text fw-bold mb-0"
														th:text="${rd.r21_23}"></p>
													<div class="btn-group">
														<a class="btn btn-sm btn-outline-success"
															th:href="@{/request/acceptOrder(rId=${rd.id})}">
															ÏäπÏù∏
														</a>
														<a class="btn btn-sm btn-outline-danger"
															th:href="@{/request/rejectOrder(rId=${rd.id})}">
															Í±∞Ï†à
														</a>
													</div>
												</div>
												<div th:if="${rd.rstatus != 'ÏöîÏ≤≠ÏôÑÎ£å'}">
													<p class="card-text fw-bold mb-0" th:text="${rd.mid}"></p>
													<p class="card-text fw-bold mb-0" th:text="${rd.bdate}"></p>
													<p th:if="${rd.r11_13 != 'X'}" class="card-text fw-bold mb-0"
														th:text="${rd.r11_13}"></p>
													<p th:if="${rd.r13_15 != 'X'}" class="card-text fw-bold mb-0"
														th:text="${rd.r13_15}"></p>
													<p th:if="${rd.r15_17 != 'X'}" class="card-text fw-bold mb-0"
														th:text="${rd.r15_17}"></p>
													<p th:if="${rd.r17_19 != 'X'}" class="card-text fw-bold mb-0"
														th:text="${rd.r17_19}"></p>
													<p th:if="${rd.r19_21 != 'X'}" class="card-text fw-bold mb-0"
														th:text="${rd.r19_21}"></p>
													<p th:if="${rd.r21_23 != 'X'}" class="card-text fw-bold mb-0"
														th:text="${rd.r21_23}"></p>
													<p th:text="${rd.rstatus}"
														th:classappend="${rd.rstatus == 'ÏäπÏù∏'} ? 'btn-outline-success' : 'btn-outline-danger'"
														class="btn btn-sm"></p>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</form>
	</section>
	<!-- Related items section-->
	<!-- <section class="py-5 bg-light">
      <div class="container px-4 px-lg-5 mt-5">
        <h2 class="fw-bolder mb-4">Related products</h2>
        <div
          class="row gx-4 gx-lg-5 row-cols-2 row-cols-md-3 row-cols-xl-4 justify-content-center"
        >
          <div class="col mb-5">
            <div class="card h-100">
              Product image
              <img
                class="card-img-top"
                src="https://dummyimage.com/450x300/dee2e6/6c757d.jpg"
                alt="..."
              />
              Product details
              <div class="card-body p-4">
                <div class="text-center">
                  Product name
                  <h5 class="fw-bolder">Fancy Product</h5>
                  Product price
                  $40.00 - $80.00
                </div>
              </div>
              Product actions
              <div class="card-footer p-4 pt-0 border-top-0 bg-transparent">
                <div class="text-center">
                  <a class="btn btn-outline-dark mt-auto" href="#"
                    >View options</a
                  >
                </div>
              </div>
            </div>
          </div>
          <div class="col mb-5">
            <div class="card h-100">
              Sale badge
              <div
                class="badge bg-dark text-white position-absolute"
                style="top: 0.5rem; right: 0.5rem"
              >
                Sale
              </div>
              Product image
              <img
                class="card-img-top"
                src="https://dummyimage.com/450x300/dee2e6/6c757d.jpg"
                alt="..."
              />
              Product details
              <div class="card-body p-4">
                <div class="text-center">
                  Product name
                  <h5 class="fw-bolder">Special Item</h5>
                  Product reviews
                  <div
                    class="d-flex justify-content-center small text-warning mb-2"
                  >
                    <div class="bi-star-fill"></div>
                    <div class="bi-star-fill"></div>
                    <div class="bi-star-fill"></div>
                    <div class="bi-star-fill"></div>
                    <div class="bi-star-fill"></div>
                  </div>
                  Product price
                  <span class="text-muted text-decoration-line-through"
                    >$20.00</span
                  >
                  $18.00
                </div>
              </div>
              Product actions
              <div class="card-footer p-4 pt-0 border-top-0 bg-transparent">
                <div class="text-center">
                  <a class="btn btn-outline-dark mt-auto" href="#"
                    >Add to cart</a
                  >
                </div>
              </div>
            </div>
          </div>
          <div class="col mb-5">
            <div class="card h-100">
              Sale badge
              <div
                class="badge bg-dark text-white position-absolute"
                style="top: 0.5rem; right: 0.5rem"
              >
                Sale
              </div>
              Product image
              <img
                class="card-img-top"
                src="https://dummyimage.com/450x300/dee2e6/6c757d.jpg"
                alt="..."
              />
              Product details
              <div class="card-body p-4">
                <div class="text-center">
                  Product name
                  <h5 class="fw-bolder">Sale Item</h5>
                  Product price
                  <span class="text-muted text-decoration-line-through"
                    >$50.00</span
                  >
                  $25.00
                </div>
              </div>
              Product actions
              <div class="card-footer p-4 pt-0 border-top-0 bg-transparent">
                <div class="text-center">
                  <a class="btn btn-outline-dark mt-auto" href="#"
                    >Add to cart</a
                  >
                </div>
              </div>
            </div>
          </div>
          <div class="col mb-5">
            <div class="card h-100">
              Product image
              <img
                class="card-img-top"
                src="https://dummyimage.com/450x300/dee2e6/6c757d.jpg"
                alt="..."
              />
              Product details
              <div class="card-body p-4">
                <div class="text-center">
                  Product name
                  <h5 class="fw-bolder">Popular Item</h5>
                  Product reviews
                  <div
                    class="d-flex justify-content-center small text-warning mb-2"
                  >
                    <div class="bi-star-fill"></div>
                    <div class="bi-star-fill"></div>
                    <div class="bi-star-fill"></div>
                    <div class="bi-star-fill"></div>
                    <div class="bi-star-fill"></div>
                  </div>
                  Product price
                  $40.00
                </div>
              </div>
              Product actions
              <div class="card-footer p-4 pt-0 border-top-0 bg-transparent">
                <div class="text-center">
                  <a class="btn btn-outline-dark mt-auto" href="#"
                    >Add to cart</a
                  >
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section> -->
	<!-- Footer-->
	<footer class="py-5">
		<div class="container">
			<p class="m-0 text-center">Copyright &copy; Your Website 2023</p>
		</div>
	</footer>
	<!-- Bootstrap core JS-->
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
	<!-- Core theme JS-->
	<script src="/js/scripts.js"></script>
	<script th:inline="javascript">
		// Thymeleaf Î¶¨Ïä§Ìä∏Î•º JS Î∞∞Ïó¥Î°ú Î≥ÄÌôò
		const imageList = /*[[${placeDto.pfilenameList}]]*/[];
		let currentIndex = 0;

		function showImage(index) {
			const imageElement = document.getElementById("productImage");
			imageElement.src = imageList[index];
		}

		function showPrevImage() {
			currentIndex = (currentIndex - 1 + imageList.length) % imageList.length;
			showImage(currentIndex);
		}

		function showNextImage() {
			currentIndex = (currentIndex + 1) % imageList.length;
			showImage(currentIndex);
		}
	</script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
	<script th:inline="javascript">
		function getBdateList() {
			console.log("check BdateList");
			const dateEl = document.getElementById("bdate");
			const selectedDate = new Date(dateEl.value);
			const today = new Date();
			today.setHours(0, 0, 0, 0);
			const pid = "[[${placeDto.id}]]";
			if (selectedDate < today) {
				alert("Í≥ºÍ±∞ ÎÇ†ÏßúÎäî ÏòàÏïΩÌï† Ïàò ÏóÜÏäµÎãàÎã§.");
				//dateEl.value=""
				return;
			}

			$.ajax({
				url: "/request/getBdate",
				type: "get",
				data: {bdate: dateEl.value, pId: pid},
				dataType: "json",
				success: function (response) {
					modifyCheckBox(response);
				},
			});
		}

		function modifyCheckBox(raList) {
			console.log("check raList");
			const r11_13 = document.getElementById("r11_13");
			const r13_15 = document.getElementById("r13_15");
			const r15_17 = document.getElementById("r15_17");
			const r17_19 = document.getElementById("r17_19");
			const r19_21 = document.getElementById("r19_21");
			const r21_23 = document.getElementById("r21_23");
			r11_13.disabled = false;
			r13_15.disabled = false;
			r15_17.disabled = false;
			r17_19.disabled = false;
			r19_21.disabled = false;
			r21_23.disabled = false;
			for (let ra of raList) {
				if (ra.r11_13 == "O") {
					r11_13.disabled = true;
				}
				if (ra.r13_15 == "O") {
					r13_15.disabled = true;
				}
				if (ra.r15_17 == "O") {
					r15_17.disabled = true;
				}
				if (ra.r17_19 == "O") {
					r17_19.disabled = true;
				}
				if (ra.r19_21 == "O") {
					r19_21.disabled = true;
				}
				if (ra.r21_23 == "O") {
					r21_23.disabled = true;
				}
			}

			const checkBoxs = document.querySelectorAll(".form-check-input");
			const allDisabled = Array.from(checkBoxs).every((cb) => cb.disabled);
			if (allDisabled) {
				alert("Ìï¥Îãπ ÏùºÏûêÎäî ÏòàÏïΩÏù¥ Î∂àÍ∞ÄÎä• Ìï©ÎãàÎã§.");
				window.location.href = "/place/view/" + "[[${placeDto.id}]]";
			}
		}

		function validateCheckboxes() {
			const checkboxes = document.querySelectorAll('.form-check-input');
			let leastOneChecked = false;

			checkboxes.forEach(function (checkbox) {
				if (checkbox.checked) {
					leastOneChecked = true;
				}
			});

			if (!leastOneChecked) {
				alert("ÏãúÍ∞ÑÏùÑ ÌïòÎÇò Ïù¥ÏÉÅ ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.");
				return false;
			}
			return true;
		}
	</script>

</body>

</html>