<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js" integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q" crossorigin="anonymous"></script>
</head>
<body>
<h1>뉴스 스크랩</h1>
<select id="selectPortal">
    <option value="">-선택-</option>
	<option value="naver">네이버</option>
	<option value="daum">다음</option>
</select>
<select id="selectSection">
	<option value="">포털 사이트를 먼저 선택해주십시오.</option>
</select>
<button class="btn btn-primary" id="scrapeNewsBtn">뉴스 수집</button>
<button class="btn btn-success" id="showNewsBtn">뉴스 조회</button>
<hr>
<table>
	<thead>
		<tr>
		    <th>기사번호</th>
		    <th>포털</th>
			<th>카테고리</th>
			<th>언론사</th>
			<th>기사제목</th>
			<th>기재시간</th>
			<th>기사요약</th>
		</tr>
	</thead>
	<tbody id="tableBody">		
		
	</tbody>
</table>

<!-- 뉴스 수집 완료 알림(toast) -->
<div class="toast-container position-fixed bottom-0 end-0 p-3">
  <div id="scrapeNewsToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
    <div class="toast-header">
      <strong class="me-auto">뉴스스크랩</strong>
      <small></small>
      <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
    </div>
    <div id="toast-body" class="toast-body">
    </div>
  </div>
</div>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script type="text/javascript">
	// 뉴스 수집 버튼 선택
	const scrapeNewsBtn = document.getElementById("scrapeNewsBtn");
	// 뉴스 수집 완료 알림 toast 선택
	const scrapeNewsToast = document.getElementById("scrapeNewsToast");
	
	const toastBootStrap = bootstrap.Toast.getOrCreateInstance(scrapeNewsToast);
	
	const toastBodyEl = document.getElementById("toast-body");
	// 뉴스 수집 버튼 클릭 이벤트 등록
	scrapeNewsBtn.addEventListener("click", function() {
        // 카테고리 선택 값
		const category = document.getElementById("selectSection");
		const portal = document.getElementById("selectPortal");
		
		
        console.log("선택한 수집 카테고리 값: " + category.value);
        console.log("선택한 수집 포털 값: " + portal.value);
		// ajax로 선택한 카테고리의 뉴스 수집 요청
		$.ajax({
			url: "/scrapeNews",
			type: "get",
			data: {"section": category.value, "portal": portal.value},
			success: function(res){
				toastBodyEl.innerHTML = res;
				toastBootStrap.show();
			},
		});
		// ajax 응답
		
		
    });
	
	const showNewsBtn = document.getElementById("showNewsBtn");
	
	const tableBodyEl = document.getElementById("tableBody");
	
	showNewsBtn.addEventListener("click", function(){
		
		const category = document.getElementById("selectSection");
		const portal = document.getElementById("selectPortal");
		
		const portalValue = portal.value; // 선택된 도메인의 value
		
		const categoryValue = category.value; // 선택된 카테고리의 value
		const categoryName = category.options[category.selectedIndex].text;
		console.log("선택한 출력 카테고리 값: " + categoryValue);
		console.log("선택한 카테고리 텍스트: " + categoryName);
		$.ajax({
			url: "/showNews",
			type: "get",
			data: {"section": categoryValue, "portal": portalValue},
			dataType: "json",
			success: function(res){
				tableBodyEl.innerHTML = ""; // 기존 데이터 초기화
				if(res.length == 0){
					toastBodyEl.innerHTML = "조회된 뉴스가 없습니다.";
                    toastBootStrap.show();
                    return;
				}
				/* for(news of res){
					tableBodyEl.innerHTML += `<tr>
                        <td>${categoryName}</td>
                        <td><a href="${news.linkUrl}">${news.title}</a></td>`;
				} */
				/* 
				<tr>
				    <th>기사번호</th>
					<th>카테고리</th>
					<th>언론사</th>
					<th>기사제목</th>
					<th>기재시간</th>
					<th>기사요약</th>
				</tr>
				*/
				res.forEach((news,index) => {
                    tableBodyEl.innerHTML += `<tr>
                        <td>${++index}</td>
                        <td>${news.portal}</td>
                        <td>${categoryName}</td>
                        <td>${news.journal}</td>
                        <td><a href="${news.linkUrl}" target="_blank">${news.title}</a></td>
                        <td><small>${news.newsTime}</small></td>
                        <td>${news.newsContent}</td>
                    </tr>`;
                });
				toastBodyEl.innerHTML = `${res.length}개의 뉴스가 조회되었습니다.`;
                toastBootStrap.show();
			},
		});
		
	});
	
	const options = {
		naver: [{value: "section/100", text: "정치"},
                {value: "section/101", text: "경제"},
                {value: "section/102", text: "사회"},
                {value: "section/103", text: "생활/문화"},
                {value: "section/105", text: "IT/과학"},
                {value: "section/104", text: "세계"}],
	    daum:  [{value: "climate", text: "기후/환경"},
                {value: "society", text: "사회"},
                {value: "economy", text: "경제"},
                {value: "politics", text: "정치"},
                {value: "world", text: "세계"},
                {value: "culture", text: "문화"},
                {value: "tech", text: "IT/과학"},
                {value: "people", text: "인물"},
                {value: "understanding", text: "지식/칼럼"}]
	};
	
	const portalSelector = document.getElementById("selectPortal");
	const sectionSelector = document.getElementById("selectSection");
	
	portalSelector.addEventListener("change", function(){
		const selected = this.value;
		sectionSelector.innerHTML = ""; // 기존 옵션 초기화
		
		if (options[selected]) {
		      options[selected].forEach(opt => {
		        const optionEl = document.createElement("option");
		        optionEl.value = opt.value;
		        optionEl.textContent = opt.text;
		        sectionSelector.appendChild(optionEl);
		      });
		    }
	});
	
</script>
</body>
</html>