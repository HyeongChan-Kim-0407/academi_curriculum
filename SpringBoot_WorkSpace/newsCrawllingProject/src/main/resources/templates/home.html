<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js" integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q" crossorigin="anonymous"></script>
</head>
<body>
<h1>뉴스 스크랩</h1>
<select id="selectSection">
	<option value="100">정치</option>
	<option value="101">경제</option>
	<option value="102">사회</option>
	<option value="103">생활/문화</option>
	<option value="105">IT/과학</option>
	<option value="104">세계</option>
</select>
<button class="btn btn-primary" id="scrapeNewsBtn">뉴스 수집</button>
<button class="btn btn-success" id="showNewsBtn">뉴스 조회</button>
<hr>
<table>
	<thead>
		<tr>
		    <th>기사번호</th>
			<th>카테고리</th>
			<th>기사제목</th>
		</tr>
	</thead>
	<tbody id="tableBody">		
		
	</tbody>
</table>

<!-- 뉴스 수집 완료 알림(toast) -->
<div class="toast-container position-fixed bottom-0 end-0 p-3">
  <div id="scrapeNewsToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
    <div class="toast-header">
      <strong class="me-auto">뉴스스크랩</strong>
      <small></small>
      <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
    </div>
    <div id="toast-body" class="toast-body">
    </div>
  </div>
</div>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script type="text/javascript">
	// 뉴스 수집 버튼 선택
	const scrapeNewsBtn = document.getElementById("scrapeNewsBtn");
	// 뉴스 수집 완료 알림 toast 선택
	const scrapeNewsToast = document.getElementById("scrapeNewsToast");
	
	const toastBootStrap = bootstrap.Toast.getOrCreateInstance(scrapeNewsToast);
	
	const toastBodyEl = document.getElementById("toast-body");
	// 뉴스 수집 버튼 클릭 이벤트 등록
	scrapeNewsBtn.addEventListener("click", function() {
        // 카테고리 선택 값
		const category = document.getElementById("selectSection");
        console.log("선택한 수집 카테고리 값: " + category.value);
		// ajax로 선택한 카테고리의 뉴스 수집 요청
		$.ajax({
			url: "/scrapeNews",
			type: "get",
			data: {"sectionNumber": category.value},
			success: function(res){
				toastBodyEl.innerHTML = res;
				toastBootStrap.show();
			},
		});
		// ajax 응답
		
		
    });
	
	const showNewsBtn = document.getElementById("showNewsBtn");
	
	const tableBodyEl = document.getElementById("tableBody");
	
	showNewsBtn.addEventListener("click", function(){
		
		const category = document.getElementById("selectSection");
		const categoryValue = category.value; // 선택된 카테고리의 value
		const categoryName = category.options[category.selectedIndex].text;
		console.log("선택한 출력 카테고리 값: " + categoryValue);
		console.log("선택한 카테고리 텍스트: " + categoryName);
		$.ajax({
			url: "/showNews",
			type: "get",
			data: {"sectionNumber": categoryValue},
			dataType: "json",
			success: function(res){
				tableBodyEl.innerHTML = ""; // 기존 데이터 초기화
				if(res.length == 0){
					toastBodyEl.innerHTML = "조회된 뉴스가 없습니다.";
                    toastBootStrap.show();
                    return;
				}
				/* for(news of res){
					tableBodyEl.innerHTML += `<tr>
                        <td>${categoryName}</td>
                        <td><a href="${news.linkUrl}">${news.title}</a></td>`;
				} */
				res.forEach((news,index) => {
                    tableBodyEl.innerHTML += `<tr>
                        <td>${++index}</td>
                        <td>${categoryName}</td>
                        <td><a href="${news.linkUrl}" target="_blank">${news.title}</a></td>
                    </tr>`;
                });
				toastBodyEl.innerHTML = `${res.length}개의 뉴스가 조회되었습니다.`;
                toastBootStrap.show();
			},
		});
		
	});
	
	
</script>
</body>
</html>