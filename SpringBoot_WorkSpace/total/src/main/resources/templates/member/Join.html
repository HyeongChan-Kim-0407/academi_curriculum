<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>Join</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>
</head>
<body>
	<nav class="navbar bg-primary">
		<div class="container-fluid">
			<a class="navbar-brand text-light">Join</a>
			<div class="d-flex">
				<a href="/member/login" class="btn btn-outline-light me-2" type="button">로그인</a>
				<a href="/member/join" class="btn btn-success" type="submit">회원가입</a>
			</div>
		</div>
	</nav>
	<div class="container d-flex justify-content-center align-items-center vh-100">
    <div class="card p-4 rounded-4" style="max-width: 400px; width: 100%;">
      <h3 class="text-center mb-4">회원가입</h3>
      <form action="/member/join" method="post" id="joinForm" onsubmit="return checkForm(this)" th:object="${memberForm}">
        <!-- 아이디 -->
        <div class="mb-3">
          <label for="mid" class="form-label">아이디</label>
          	<div class="input-group">
          		<input type="text" th:classappend="${#fields.hasErrors('mid')}? 'is-invalid'" class="form-control" th:field="*{mid}" placeholder="아이디를 입력하세요" onchange="checkDuplId()">
          		<!-- <button type="button" class="btn btn-primary text-light" onclick="checkDuplId()" >중복확인</button> -->
          	</div>
          	<small id="checkIdMsg"></small>
          	<small th:if="${#fields.hasErrors('mid')}" th:errors="*{mid}"></small>
        </div>
        <!-- 비밀번호 -->
        <div class="mb-3">
          <label for="mpw" class="form-label">비밀번호</label>
          <input type="password" th:classappend="${#fields.hasErrors('mpw')}? 'is-invalid'" th:field="*{mpw}" class="form-control" id="mpw" name="mpw" placeholder="비밀번호를 입력하세요">
        </div>
        	<small id="checkPwMsg" th:if="${#fields.hasErrors('mpw')}" th:errors="*{mpw}"></small>
        <!-- 이름 -->
        <div class="mb-3">
          <label for="mname" class="form-label">이름</label>
          <input type="text" th:classappend="${#fields.hasErrors('mname')}? 'is-invalid'" th:field="*{mname}" class="form-control" id="mname" name="mname" placeholder="이름을 입력하세요">
        </div>
        	<small id="checkNameMsg" th:if="${#fields.hasErrors('mname')}" th:errors="*{mname}"></small>
        <!-- 이메일 -->
        <div class="mb-3">
          <label for="memail" class="form-label">이메일</label>
          <input type="email" th:field="*{memail}" class="form-control" id="memail" name="memail" placeholder="example@email.com">
        </div>
        <!-- 버튼 -->
        <div class="d-grid">
          <button type="submit" class="btn btn-primary rounded-3">가입하기</button>
        </div>
      </form>
    </div>
  </div>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
	<script type="text/javascript">
		let duplCheck;
		
		document.getElementById("mid").addEventListener("input", function(){
			duplCheck = false;
			document.getElementById("checkIdMsg").innerText = "";
			document.getElementById("mid").classList.remove("is-invalid");
	        document.getElementById("mid").classList.remove("is-valid");
		});
		
		function checkForm(form){
			
			if(!duplCheck){
				document.getElementById("checkIdMsg").innerText = "아이디 중복확인을 진행해주십시오.";
				return false;
			}
			return true;
		}
		
		function checkDuplId(){
			const checkIdMsg = document.getElementById("checkIdMsg");
			const mid = document.getElementById("mid");
			if(mid.value.trim() <= 0){
				checkIdMsg.innerText = "아이디를 입력해주십시오.";
				mid.classList.add("is-invalid");
				checkIdMsg.classList.add("text-red");
				return;
			}
			$.ajax({
				url: "/member/checkId",
				type: "post",
				data: { mid: mid.value.trim() },
				success: function(res){
					if(res =="Y"){
						mid.classList.add("is-valid");
			            mid.classList.remove("is-invalid");
			            checkIdMsg.innerHTML = "사용 가능한 아이디입니다.";
			            checkIdMsg.classList.add("text-green");
			            checkIdMsg.classList.remove("text-red");
			            duplCheck = true;
					}
					if(res =="N"){
						mid.classList.add("is-invalid");
                        mid.classList.remove("is-valid");
                        checkIdMsg.innerHTML = "이미 사용중인 아이디입니다.";
                        checkIdMsg.classList.add("text-red");
                        checkIdMsg.classList.remove("text-green");
                        duplCheck = false;
					}
				}
			});
		}
		
	</script>
</body>
</html>